<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>reactGlass – Hook Demo</title>
    <style>
      :root {
        --bg: #05070f;
        --gradient-1: #0ea5e9;
        --gradient-2: #6366f1;
        --text: #e2e8f0;
      }
      * { box-sizing: border-box; }
      /* Place the requested image at demos/assets/background.jpg to avoid CORS issues. */
      body {
        margin: 0;
        min-height: 100vh;
        background:
          linear-gradient(135deg, rgba(5,7,15,0.95), rgba(8,12,24,0.9)),
          url("./assets/background.jpg") center/cover fixed no-repeat;
        font-family: "Space Grotesk", "Inter", system-ui, sans-serif;
        color: var(--text);
        display: grid;
        place-items: center;
        padding: 32px;
      }
      .shell {
        width: min(1100px, 100%);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 24px;
      }
      .glass-block {
        padding: 24px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.01);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      h3 { margin: 0 0 10px; }
      p { margin: 0 0 12px; color: #cbd5e1; line-height: 1.6; }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 12px;
        border-radius: 999px;
        background: linear-gradient(135deg, rgba(14,165,233,0.18), rgba(99,102,241,0.18));
        color: #e0f2fe;
        font-size: 12px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        border: 1px solid rgba(255,255,255,0.12);
      }
      .cta {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid rgba(255,255,255,0.12);
        color: #e2e8f0;
        text-decoration: none;
        transition: transform 0.2s ease, border-color 0.2s ease;
      }
      .cta:hover { transform: translateY(-2px); border-color: rgba(255,255,255,0.25); }

      #blob-canvas {
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -3;
        filter: blur(18px) saturate(120%);
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18",
          "react/jsx-runtime": "https://esm.sh/react@18/jsx-runtime"
        }
      }
    </script>

    <script type="module">
      import React from "https://esm.sh/react@18";
      import { createRoot } from "https://esm.sh/react-dom@18/client";

      function startBlobBackground() {
        const canvas = document.createElement("canvas");
        canvas.id = "blob-canvas";
        document.body.prepend(canvas);
        const ctx = canvas.getContext("2d");
        const palette = ["#2dd4bf", "#6366f1", "#f472b6", "#22d3ee", "#c084fc"];
        const blobs = Array.from({ length: 8 }).map(() => ({
          x: Math.random(),
          y: Math.random(),
          r: 120 + Math.random() * 160,
          vx: (Math.random() * 0.6 - 0.3) * 0.0007,
          vy: (Math.random() * 0.6 - 0.3) * 0.0007,
          color: palette[Math.floor(Math.random() * palette.length)],
        }));

        let dpr = window.devicePixelRatio || 1;
        const resize = () => {
          dpr = window.devicePixelRatio || 1;
          canvas.width = innerWidth * dpr;
          canvas.height = innerHeight * dpr;
          canvas.style.width = "100%";
          canvas.style.height = "100%";
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        };
        resize();
        window.addEventListener("resize", resize, { passive: true });

        const tick = () => {
          ctx.clearRect(0, 0, innerWidth, innerHeight);
          blobs.forEach((b, i) => {
            b.x += b.vx;
            b.y += b.vy;
            if (b.x < 0 || b.x > 1) b.vx *= -1;
            if (b.y < 0 || b.y > 1) b.vy *= -1;
            const cx = b.x * innerWidth;
            const cy = b.y * innerHeight;
            const grad = ctx.createRadialGradient(
              cx,
              cy,
              b.r * 0.15,
              cx,
              cy,
              b.r
            );
            grad.addColorStop(0, `${b.color}dd`);
            grad.addColorStop(1, "rgba(0,0,0,0)");
            ctx.globalCompositeOperation = i % 2 === 0 ? "screen" : "lighter";
            ctx.beginPath();
            ctx.fillStyle = grad;
            ctx.arc(cx, cy, b.r, 0, Math.PI * 2);
            ctx.fill();
          });
          ctx.globalCompositeOperation = "source-over";
          requestAnimationFrame(tick);
        };
        requestAnimationFrame(tick);
      }

      startBlobBackground();

      const rootEl = document.getElementById("root");

      async function loadHook() {
        const attempts = ["../dist/index.js", "../dist/reactGlass.js"];
        for (const path of attempts) {
          try {
            const mod = await import(path);
            if (mod.useReactGlass) return mod.useReactGlass;
          } catch (e) {
            // ignore and try next
          }
        }
        throw new Error("useReactGlass export missing from dist build");
      }

      let useReactGlass;
      try {
        useReactGlass = await loadHook();
      } catch (err) {
        console.error("Could not load reactGlass build.", err);
        rootEl.innerHTML =
          "<p style='color:#e2e8f0;font-family:system-ui,sans-serif'>Build reactGlass first: <code>cd reactGlass && npm install && npm run build</code>. Ensure you are serving from the <code>reactGlass</code> folder so <code>dist/</code> is reachable.</p>";
        throw err;
      }

      const h = React.createElement;

      function FeatureBlock({ title, copy, options }) {
        const ref = useReactGlass(options, [options]);
        return h(
          "div",
          { ref, className: "glass-block" },
          h("div", { className: "badge" }, "Hook"),
          h("h3", null, title),
          h("p", null, copy),
          h("a", { className: "cta", href: "#" }, "Learn more →")
        );
      }

      const root = createRoot(rootEl);
      root.render(
        h(
          "div",
          { className: "shell" },
          h(FeatureBlock, {
            title: "Live Tilt",
            copy:
              "Tilt-enabled block with a deeper bevel and animated specular highlights.",
            options: { tilt: true, tiltFactor: 9, bevelDepth: 0.14, specular: true },
          }),
          h(FeatureBlock, {
            title: "Frosted HUD",
            copy: "Softer bevel, increased frost, and shadow for overlay panels.",
            options: { frost: 4, bevelWidth: 0.2, bevelDepth: 0.05, shadow: true },
          }),
          h(FeatureBlock, {
            title: "Lens Focus",
            copy:
              "Higher refraction and magnification to spotlight background motion.",
            options: { refraction: 0.04, magnify: 1.12, specular: false },
          })
        )
      );

      // If capture fails for any reason, force content visible after a short delay.
      setTimeout(() => {
        document.querySelectorAll(".glass-block").forEach((el) => {
          const opacity = parseFloat(getComputedStyle(el).opacity || "0");
          if (opacity < 0.01) {
            el.style.opacity = "1";
            el.style.pointerEvents = "auto";
          }
        });
      }, 1200);
    </script>
  </body>
</html>
